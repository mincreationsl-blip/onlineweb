<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HighTech Admin | Manage Inventory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: #020617;
            color: #f8fafc;
        }

        .glass {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .neo-glow-cyan {
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.2);
        }

        .neo-glow-purple {
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.2);
        }
    </style>
</head>

<body class="min-h-screen">
    <nav class="glass px-6 py-4 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-2">
            <a href="index.html"
                class="w-10 h-10 bg-gradient-to-br from-cyan-400 to-purple-600 rounded-lg flex items-center justify-center neo-glow-cyan">
                <i class="fas fa-arrow-left text-white"></i>
            </a>
            <span class="text-2xl font-bold">Admin <span class="text-purple-500">Panel</span></span>
        </div>
        <div class="flex gap-4">
            <button id="tabInventory" class="px-4 py-2 bg-purple-600 rounded-lg font-bold">Inventory</button>
            <button id="tabOrders" class="px-4 py-2 hover:bg-slate-800 rounded-lg font-bold">Orders</button>
            <button id="addBtn"
                class="px-4 py-2 border border-purple-600 hover:bg-purple-600/20 rounded-lg transition-all font-bold flex items-center gap-2">
                <i class="fas fa-plus"></i> New Product
            </button>
            <button id="generateStockBtn"
                class="px-4 py-2 bg-cyan-600/20 text-cyan-400 border border-cyan-600/50 rounded-lg hover:bg-cyan-600 hover:text-white transition-all font-bold flex items-center gap-2">
                <i class="fas fa-sync-alt"></i> Refill Inventory
            </button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-6 mt-10">
        <!-- Dashboard Inventory Section -->
        <div id="inventorySection" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="space-y-6">
                <div class="glass p-6 rounded-2xl neo-glow-cyan text-center">
                    <h3 class="text-slate-400 text-sm mb-2 uppercase tracking-widest">Total Products</h3>
                    <p id="totalProducts" class="text-4xl font-bold">0</p>
                </div>
            </div>
            <div class="lg:col-span-2 space-y-6">
                <h2 class="text-2xl font-bold text-cyan-400">Inventory Management</h2>
                <div id="adminProductList" class="space-y-4"></div>
            </div>
        </div>

        <!-- Orders Section (Hidden by default) -->
        <div id="ordersSection" class="hidden space-y-8">
            <h2 class="text-3xl font-bold">Incoming <span class="text-cyan-400">Transmissions</span></h2>
            <div id="adminOrderList" class="grid grid-cols-1 gap-6">
                <!-- Orders here -->
            </div>
        </div>
    </main>

    <!-- Modal for adding products (remains same) -->
    <div id="productModal" class="fixed inset-0 z-[110] flex items-center justify-center px-4 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" id="modalOverlay"></div>
        <div class="relative glass max-w-xl w-full p-8 rounded-2xl">
            <h3 id="modalTitle" class="text-2xl font-bold mb-6">Add <span class="text-cyan-400">New Item</span></h3>
            <form id="productForm" class="space-y-4">
                <input type="hidden" id="prodId">
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Product Name</label>
                    <input type="text" id="prodName" required
                        class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 focus:border-cyan-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Product Code (e.g. HT-101)</label>
                    <input type="text" id="prodCode" required
                        class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 focus:border-cyan-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Description</label>
                    <textarea id="prodDesc" required rows="2"
                        class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 focus:border-cyan-500 outline-none"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Price (Rs.)</label>
                        <input type="number" id="prodPrice" required
                            class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 focus:border-cyan-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Category</label>
                        <select id="prodCategory"
                            class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 focus:border-cyan-500 outline-none">
                            <option value="Electronic">Electronic</option>
                            <option value="Mobile">Mobile</option>
                            <option value="Laptop">Laptop</option>
                            <option value="Audio">Audio</option>
                            <option value="Tech Gadget">Tech Gadget</option>
                            <option value="Household Items">Household Items</option>
                            <option value="Home Appliances">Home Appliances</option>
                            <option value="Women's wear">Women's wear</option>
                            <option value="Gents wear">Gents wear</option>
                            <option value="Kids wear">Kids wear</option>
                            <option value="Accessories">Accessories</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Warranty</label>
                        <input type="text" id="prodWarranty" placeholder="e.g. 1 Year"
                            class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 focus:border-cyan-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Stock Qty</label>
                        <input type="number" id="prodStock" required value="0"
                            class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 focus:border-cyan-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Status</label>
                        <select id="prodStatus"
                            class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 focus:border-cyan-500 outline-none">
                            <option value="available">Available</option>
                            <option value="not_available">Not Available</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Product Images (First will be main)</label>
                    <input type="file" id="prodImages" multiple accept="image/*"
                        class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 focus:border-cyan-500 outline-none">
                    <div id="imagePreviews" class="flex gap-2 mt-2 overflow-x-auto py-2"></div>
                    <p class="text-[10px] text-slate-500 mt-1">Select one or more images from your device. Large images
                        might exceed storage limits.</p>
                </div>
                <div class="pt-4 flex gap-4">
                    <button type="button" id="closeProdModal"
                        class="flex-1 py-3 border border-slate-700 rounded-xl hover:bg-slate-800 transition-all">Discard</button>
                    <button type="submit"
                        class="flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 neo-glow-purple">Save
                        System Entry</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/storage.js"></script>
    <script>
        const prodForm = document.getElementById('productForm');
        const prodModal = document.getElementById('productModal');
        const adminList = document.getElementById('adminProductList');
        const orderList = document.getElementById('adminOrderList');

        // Tab logic
        const invSec = document.getElementById('inventorySection');
        const ordSec = document.getElementById('ordersSection');
        const tabInv = document.getElementById('tabInventory');
        const tabOrd = document.getElementById('tabOrders');

        tabInv.onclick = () => {
            invSec.classList.remove('hidden');
            ordSec.classList.add('hidden');
            tabInv.classList.add('bg-purple-600');
            tabOrd.classList.remove('bg-purple-600');
            renderAdminProducts();
        };

        tabOrd.onclick = () => {
            ordSec.classList.remove('hidden');
            invSec.classList.add('hidden');
            tabOrd.classList.add('bg-purple-600');
            tabInv.classList.remove('bg-purple-600');
            renderAdminOrders();
        };

        function renderAdminProducts() {
            const products = Storage.getProducts();
            document.getElementById('totalProducts').innerText = products.length;
            adminList.innerHTML = products.map(p => `
                <div class="glass p-4 rounded-xl flex items-center justify-between group hover:border-cyan-500 transition-all">
                    <div class="flex items-center gap-4">
                        <img src="${p.image}" class="w-16 h-16 object-cover rounded-lg border border-slate-700">
                        <div>
                            <h4 class="font-bold">${p.name} <span class="text-cyan-500 text-xs ml-2">[${p.code || 'NO-CODE'}]</span></h4>
                            <p class="text-sm text-slate-400">Rs. ${parseFloat(p.price).toLocaleString()} | <span class="${p.status === 'not_available' ? 'text-red-400' : 'text-green-400'} text-[10px] font-bold uppercase">${p.status === 'not_available' ? 'Out of Stock' : 'Available'}</span></p>
                            <p class="text-xs font-bold ${p.stock <= 5 ? 'text-orange-400' : 'text-slate-500'}">Inventory Level: ${p.stock || 0} Units</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editProduct('${p.id}')" class="p-2 hover:text-cyan-400"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteProduct('${p.id}')" class="p-2 hover:text-red-400"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('') || '<p class="text-center opacity-30">No products</p>';
        }

        function renderAdminOrders() {
            const orders = Storage.getOrders();
            orderList.innerHTML = orders.reverse().map(o => `
                <div class="glass p-6 rounded-2xl border-l-4 border-purple-500">
                    <div class="flex flex-col md:flex-row justify-between mb-4 gap-4">
                        <div>
                            <h3 class="text-xl font-bold">${o.customer.name}</h3>
                            <p class="text-sm text-slate-400">${o.customer.phone} | ${o.customer.email}</p>
                            <p class="text-sm text-slate-400 mt-1"><i class="fas fa-map-marker-alt text-cyan-500"></i> ${o.customer.address}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-slate-500">${new Date(o.date).toLocaleString()}</p>
                            <p class="text-2xl font-bold text-cyan-400">Rs. ${o.total.toLocaleString()}</p>
                        </div>
                    </div>
                    <div class="bg-slate-900/50 p-3 rounded-lg mb-4 text-sm">
                        ${o.items.map(i => `<div>â€¢ ${i.name} x ${i.quantity}</div>`).join('')}
                    </div>
                    <div class="flex gap-3">
                        <button onclick="notifyCustomer('${o.customer.phone}', 'payment')" class="flex-1 py-2 bg-green-600/20 text-green-400 border border-green-600/50 rounded-lg hover:bg-green-600 hover:text-white transition-all text-sm font-bold">
                            <i class="fab fa-whatsapp"></i> Confirm Payment
                        </button>
                        <button onclick="notifyCustomer('${o.customer.phone}', 'shipment')" class="flex-1 py-2 bg-cyan-600/20 text-cyan-400 border border-cyan-600/50 rounded-lg hover:bg-cyan-600 hover:text-white transition-all text-sm font-bold">
                            <i class="fab fa-whatsapp"></i> Ship Details
                        </button>
                    </div>
                </div>
            `).join('') || '<div class="text-center opacity-30 py-20">No orders received yet.</div>';
        }

        window.notifyCustomer = (phone, type) => {
            let msg = "";
            if (type === 'payment') {
                msg = "Hello! Your payment has been received successfully. We are preparing your high-tech items for dispatch. Thank you!";
            } else {
                msg = "Hello! Great news, your shipment is on its way. Arrival expected soon! Track your order code: HT-" + Date.now().toString().slice(-6);
            }
            // Ensure phone is in international format (strip leading 0 if present)
            let cleanPhone = phone.replace(/[^0-9]/g, '');
            if (cleanPhone.startsWith('0')) cleanPhone = '94' + cleanPhone.substring(1);

            window.open(`https://wa.me/${cleanPhone}?text=${encodeURIComponent(msg)}`, '_blank');
        };

        // Reuse existing modal logic...

        document.getElementById('addBtn').onclick = () => {
            prodForm.reset();
            document.getElementById('prodId').value = '';
            document.getElementById('modalTitle').innerHTML = 'Add <span class="text-cyan-400">New Item</span>';
            prodModal.classList.remove('hidden');
        };

        document.getElementById('closeProdModal').onclick = () => prodModal.classList.add('hidden');
        document.getElementById('modalOverlay').onclick = () => prodModal.classList.add('hidden');

        let uploadedImages = [];

        document.getElementById('prodImages').onchange = async (e) => {
            const files = Array.from(e.target.files);
            const previewContainer = document.getElementById('imagePreviews');
            previewContainer.innerHTML = '';
            uploadedImages = [];

            for (const file of files) {
                const base64 = await convertToBase64(file);
                uploadedImages.push(base64);

                const img = document.createElement('img');
                img.src = base64;
                img.className = 'w-16 h-16 object-cover rounded-lg border border-slate-700';
                previewContainer.appendChild(img);
            }
        };

        function convertToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        prodForm.onsubmit = async (e) => {
            e.preventDefault();
            const product = {
                id: document.getElementById('prodId').value || null,
                name: document.getElementById('prodName').value,
                code: document.getElementById('prodCode').value,
                desc: document.getElementById('prodDesc').value,
                price: document.getElementById('prodPrice').value,
                category: document.getElementById('prodCategory').value,
                warranty: document.getElementById('prodWarranty').value,
                stock: parseInt(document.getElementById('prodStock').value) || 0,
                status: document.getElementById('prodStatus').value,
                // Keep old images if no new ones uploaded during edit
                images: uploadedImages.length ? uploadedImages : (document.getElementById('prodId').value ? Storage.getProductById(document.getElementById('prodId').value).images : []),
                image: uploadedImages.length ? uploadedImages[0] : (document.getElementById('prodId').value ? Storage.getProductById(document.getElementById('prodId').value).image : '')
            };

            if (!product.image && !uploadedImages.length) {
                alert("Please select at least one image.");
                return;
            }

            Storage.saveProduct(product);
            prodModal.classList.add('hidden');
            renderAdminProducts();
            uploadedImages = [];
            document.getElementById('imagePreviews').innerHTML = '';
        };

        window.deleteProduct = (id) => {
            if (confirm('System check: Are you sure you want to delete this entity?')) {
                Storage.deleteProduct(id);
                renderAdminProducts();
            }
        };

        window.editProduct = (id) => {
            const p = Storage.getProductById(id);
            if (p) {
                document.getElementById('prodId').value = p.id;
                document.getElementById('prodName').value = p.name;
                document.getElementById('prodCode').value = p.code || '';
                document.getElementById('prodDesc').value = p.desc;
                document.getElementById('prodPrice').value = p.price;
                document.getElementById('prodCategory').value = p.category;
                document.getElementById('prodWarranty').value = p.warranty || '';
                document.getElementById('prodStock').value = p.stock || 0;
                document.getElementById('prodStatus').value = p.status || 'available';

                const previewContainer = document.getElementById('imagePreviews');
                previewContainer.innerHTML = p.images ? p.images.map(img => `<img src="${img}" class="w-16 h-16 object-cover rounded-lg border border-slate-700">`).join('') : '';
                uploadedImages = p.images || [p.image];

                document.getElementById('modalTitle').innerHTML = 'Edit <span class="text-cyan-400">System Entry</span>';
                prodModal.classList.remove('hidden');
            }
        };

        document.getElementById('generateStockBtn').onclick = () => {
            if (confirm("Generate random stock levels (10-50 units) for all inventory items?")) {
                const products = Storage.getProducts();
                products.forEach(p => {
                    p.stock = Math.floor(Math.random() * 41) + 10;
                    if (p.stock > 0) p.status = 'available';
                    Storage.saveProduct(p);
                });
                renderAdminProducts();
                alert("Inventory stack replenished successfully!");
            }
        };

        renderAdminProducts();
    </script>
</body>

</html>